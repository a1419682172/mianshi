# STM32 编写液晶屏幕之多参数

## 目录：

一、 课题背景与意义	3
二、 设计方案	4
三、 应用实例	5
四、 程序或软件使用说明	5
五、总结	10
六、参考文献	10



### 一、课题背景与意义
随着我国气象事业的快速发展，人们对气象信息采集的要求也越来越高，传统的人工操作和读数不仅劳动效率低下，而且容易出现人为错误，已无法满足现代气象观测的要求，近些年，电子技术的快速发展为气象数据采集技术更新和设备换代提供了条件，数据测量的自动化，数据处理的实时化，数据传输的网络化已成为当前气象数据采集领域发展的必然趋势。目前国内气象行业已经有几万个气象数据在线监测站，但大部分监测仪主机都是采用Ｃ５１系列单片机作为中央处理芯片，工作频率低，存储能力有限，功能接口简单，缺乏扩展性。工作频率低造成采样密度低，样本数量有限，进而导致数据的可信度满足不了要求。存储能力有限，当恶劣天气导致野外观测仪器实时传输失败的时候，重要的气象观测数据不能尽可能多的保存下来，以待事后的灾害分析。有的采集器只能实现简单要素的采集和数据传输，例如单雨量站；绝大部分的采集器不带显示功能，并且只能保存半个月的数据。因此当数据质量和数据安全日益被重视的时候，采用Ｃ５１单片机的气象数据监测设备已经不能满足现代气象监测发展的需要。
自70年代第一款单片问世以来单片机的功能已经基本趋于完善。单片机集成了越来越多的资源，内部存储器也越来越大。在做大型项目时也不用考虑扩展内存，开发起来也相对简单。意法半导体推出的基于ARM内核的STM32微控制器将当前微控制器性价比水平提升了一个新高度。

### 一、理论基础与方法

首先明确我们的任务是完成基于STM32开发板的多参数气象监测墒情自动监测站模拟系统。STM32为核心设计的开发板具有以下几个有点：（1）成本低，STM32的价格相对都比较低，而且STM32强大的性能使得外部电路相对简单，其内部集成有定时器、SPI、IIC、USART、USB、CAN、A/D转换等。（2）有着完善的库函数，在系统软件使用时可以直接调用，减少了大量的工作量。（3）功耗低：STM32提供三种低功耗模式：分别是待机模式、停止模式和休眠模式。休眠模式时，只有CPU工作；停止模式时，允许以最小功耗来保证外部中断可以把STM32从停止模式唤醒；待机模式时，内部调压器被关闭，外部时钟也被关闭，使得功耗变得非常低。（4）外设精简：外设都是平时开发、实验经常用到的模块，容易上手且运用灵活。STM32系列微控制单元(MCU)无论是运行速度、存储空间还是功能接口均远胜于C51系列单片机,采用STM32芯片能够提高气象数据在线监测仪整体性能。

###  二、设计方案

1.完成关于STM32开发板的相关知识学习
(1).在网上寻找系统完备的STM32学习教程资料。
(2).搭建软件环境，包括安装 MDK5.11A代码编写软件，下载ST-LINK驱动仿真调试以及安装USB-to-serial-串口驱动。
(3).进行测试，利用教程资料的实例测试，搭建相关的硬件软件环境无误，开发板可以正常工作运行。
2.进行C语言编程及利用串口数据仿真
(1).撰写代码
明确课题要求，利用Keil uVision5软件撰写代码。实现将相关的实验要求项目现象标题正确无误的显示STM32液晶屏幕上
(2).串口数据仿真
进一步在程序中利用ADC串口编写代码，利用串口发送仿真数据来替代传感器的功能，能够实现每个项目后存在1—10随机数字的变化
(3).美化界面及下载程序
对液晶屏幕上显示的数字或图片进行美化处理，调整相应的位置坐标和字体大小，设置背景图，实现界面美观简洁，另外按返回键会显示另外一张图片。完成后烧录程序，查看现象。如有问题，便重新修改代码，直至出现最优实验结果。



### 三、应用实例

1.  基于STM32的气象数据在线监测仪设计
2.  基于STM32的手持式地面气象探测设备维修测试仪设计
3.  基于STM32的海洋气象浮标采集系统设计与实现

### 四、程序或软件使用说明
    主代码如下：
include "sys.h"
include "delay.h"
include "usart.h"
include "led.h"
include "lcd.h"
include "key.h"  
include "sram.h"   
include "malloc.h" 
include "usmart.h"  
include "sdio_sdcard.h"    
include "malloc.h" 
include "w25qxx.h"    
include "ff.h"  
include "exfuns.h"    
include "fontupd.h"
include "text.h"	
include "adc.h"
 
int main(void)
{        
	u32 fontcnt;		  
	u8 i,j,a,b,c,d,e,f,g,h,k,l,m,n,o;
	u16 adcx;
	float temp;
	u8 fontx[2];//gbkÂë
	u8 key,t;
	NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);	delay_init(168);  
	uart_init(115200);		
	LED_Init();					 
 	LCD_Init();					
 	KEY_Init();					
		Adc_Init();         
	W25QXX_Init();				
	usmart_dev.init(168);		
	my_mem_init(SRAMIN);		
	my_mem_init(SRAMCCM);		
	exfuns_init();				
  	f_mount(fs[0],"0:",1); 		 
 	f_mount(fs[1],"1:",1); 		
	while(font_init()) 			
	{
UPD:    
		LCD_Clear(WHITE);		   
 		POINT_COLOR=RED;				   	  
		LCD_ShowString(30,50,200,16,16,"Explorer STM32F4");
		while(SD_Init())			
		{
			LCD_ShowString(30,70,200,16,16,"SD Card Failed!");
			delay_ms(200);
			LCD_Fill(30,70,200+30,70+16,WHITE);
			delay_ms(200);		    
		}								 						    
		LCD_ShowString(30,70,200,16,16,"SD Card OK");
		LCD_ShowString(30,90,200,16,16,"Font Updating...");
		key=update_font(20,110,16,"0:");
		while(key)	
		{			 		  
			LCD_ShowString(30,110,200,16,16,"Font Update Failed!");
			delay_ms(200);
			LCD_Fill(20,110,200+20,110+16,WHITE);
			delay_ms(200);		       
		} 		  
		LCD_ShowString(30,110,200,16,16,"Font Update Success!   ");
		delay_ms(1500);	
		LCD_Clear(WHITE);      
	}  
	POINT_COLOR=RED;       
	Show_Str(140,30,200,16,"多参数墒情自动监测站",16,0);				    	 

 	POINT_COLOR=BLUE;  
	Show_Str(30,70,200,16,"土壤温度",16,0);				    	 
	Show_Str(30,100,200,16,"土壤湿度",16,0);				    	 
	Show_Str(30,130,200,16,"土壤PH",16,0);
	Show_Str(30,160,200,16,"土壤EC",16,0);
	Show_Str(30,190,200,16,"风速",16,0);
	Show_Str(30,220,200,16,"风向",16,0);
	Show_Str(30,250,200,16,"电池电量",16,0);
	Show_Str(250,70,200,16,"大气温度",16,0);
	Show_Str(250,100,200,16,"大气湿度",16,0);
	Show_Str(250,130,200,16,"大气湿压力",16,0);
	Show_Str(250,160,200,16,"PM2.5",16,0);
	Show_Str(250,190,200,16,"露点温度",16,0);
	Show_Str(250,220,200,16,"光照强度",16,0);
	Show_Str(250,250,200,16,"降雨量",16,0);
 
	while(1)
	{
		POINT_COLOR=RED; 
		adcx=Get_Adc_Average(ADC_Channel_5,20);

		LCD_ShowxNum(150,70,adcx%10,1,16,0);    
		temp=(float)adcx*(3.3/4096);          
		adcx=temp;                            
	 
		//LCD_ShowxNum(134,150,,1,16,0);    
		temp-=adcx;                           
		temp*=1000;                           
		a=temp*8;
		b=temp*7;
		c=temp*6;
		d=temp*5;
		e=temp*4;
		f=temp*3;
		g=temp*11;
		h=temp*12;
		k=temp*13;
		l=temp*14;
		m=temp*15;
		n=temp*16;
		o=temp*17;
		
		
		LCD_ShowxNum(150,100,b%10,1,16,0X80);
		LCD_ShowxNum(150,130,a%10,1,16,0X80); 
		LCD_ShowxNum(150,160,c%10,1,16,0X80);
		LCD_ShowxNum(150,190,d%10,1,16,0X80);
		LCD_ShowxNum(150,220,e%10,1,16,0X80);
		LCD_ShowxNum(150,250,f%10,1,16,0X80);
		LCD_ShowxNum(370,70,g%10,1,16,0X80);
		LCD_ShowxNum(370,100,h%10,1,16,0X80);
		LCD_ShowxNum(370,130,k%10,1,16,0X80);
		LCD_ShowxNum(370,160,l%10,1,16,0X80);
		LCD_ShowxNum(370,190,m%10,1,16,0X80);
		LCD_ShowxNum(370,220,n%10,1,16,0X80);
		LCD_ShowxNum(370,250,o%10,1,16,0X80);
		
		LED0=!LED0;
		delay_ms(250);	
		
	} 
}

程序说明：

显示的标题项目及对应的数字设定好相应的坐标，调整位置做好界面排版。
利用串口ADC程序发送0—10的随机数随机显示。

主程序HZ.c在文件夹USER里；

HZ.hex文件在文件夹OBJ里；

使用C语言进行编程；

编程软件是Keil uVision5；

串口下载工具是FlyMcu；


### 五、总结
我们已经严格按照课设要求完成了实验项目。能够实现每个项目后各个测量量后的数值每秒钟变换一次，数值为 0-10 的随机数，且当按下返回键后显示另一张图片，如图所示.然后因为无法插入SD卡，开发板上FLASH内存只有64K，无法实现显示太大的图片。也就是不能插入背景图，也不能实现按返回键到另一张图片。

### 六、参考文献
[1]钟鼎.基于STM32的气象数据采集系统设计与实现[D].湖北:中国地质大学(武汉),2012.
[2]黄飞龙,黄海莹,何艳丽.基于STM32的气象数据在线监测仪设计[J].计算机测量与控制,2018,26(11):288-292.
[3]王梓烨,刘欲哲,周传宝.基于STM32的教学用开发板设计[J].电子世界,2018(01):70+72.
[4]王柏林,王皖东,刘云平.基于STM32的海洋气象浮标采集系统设计与实现[J].气象水文海洋仪器,2019,36(02):85-89.
